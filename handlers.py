import logging
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    CallbackContext, 
    CommandHandler, 
    MessageHandler, 
    Filters, 
    CallbackQueryHandler,
    Updater
)
from config import DISTRICTS_INFO, ORG_INFO, DOCUMENTS_LIST, FAQ_TEXT, is_admin, ADMINS
from database import save_user_session, log_user_action, init_db, get_statistics, get_user_info, log_admin_action, broadcast_message

logger = logging.getLogger(__name__)

def setup_handlers(updater: Updater):
    """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –≤–µ—Ä—Å–∏–∏ 13.x"""
    dp = updater.dispatcher
    
    # –ö–æ–º–∞–Ω–¥—ã
    dp.add_handler(CommandHandler("start", start_command))
    dp.add_handler(CommandHandler("help", help_command))
    dp.add_handler(CommandHandler("payment", payment_command))
    dp.add_handler(CommandHandler("documents", documents_command))
    dp.add_handler(CommandHandler("faq", faq_command))
    dp.add_handler(CommandHandler("stats", stats_command))
    dp.add_handler(CommandHandler("admin", admin_command))
    dp.add_handler(CommandHandler("broadcast", broadcast_command))
    
    # Callback –∑–∞–ø—Ä–æ—Å—ã
    dp.add_handler(CallbackQueryHandler(handle_district_selection, pattern='^district_'))
    dp.add_handler(CallbackQueryHandler(handle_base_selection, pattern='^base_'))
    dp.add_handler(CallbackQueryHandler(handle_main_menu, pattern='^main_'))
    dp.add_handler(CallbackQueryHandler(handle_back, pattern='^back_'))
    dp.add_handler(CallbackQueryHandler(handle_admin_actions, pattern='^admin_'))
    
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏)
    dp.add_handler(MessageHandler(Filters.text & ~Filters.command, handle_message))
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
    init_db()

def start_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user = update.effective_user
    save_user_session(user.id, user.username, user.first_name, user.last_name)
    log_user_action(user.id, 'start')
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
    if is_admin(user.id):
        show_admin_menu(update, context)
        return
    
    keyboard = [
        [InlineKeyboardButton("üèÉ –í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω", callback_data='main_districts')],
        [InlineKeyboardButton("üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ–ø–ª–∞—Ç—ã", callback_data='main_payment')],
        [InlineKeyboardButton("üìã –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", callback_data='main_documents')],
        [InlineKeyboardButton("‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã", callback_data='main_faq')]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    welcome_text = f"""
ü§∫ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>–¢–æ–ª—å—è—Ç—Ç–∏–Ω—Å–∫—É—é —Ñ–µ–¥–µ—Ä–∞—Ü–∏—é —Ñ–µ—Ö—Ç–æ–≤–∞–Ω–∏—è</b>!

–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ:
‚Ä¢ –í—ã–±—Ä–∞—Ç—å —É–¥–æ–±–Ω—ã–π —Ä–∞–π–æ–Ω –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚Ä¢ –£–∑–Ω–∞—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
‚Ä¢ –ù–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª:
    """
    
    update.message.reply_text(welcome_text, reply_markup=reply_markup, parse_mode='HTML')

def admin_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /admin"""
    user = update.effective_user
    
    if not is_admin(user.id):
        update.message.reply_text("‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.")
        return
    
    show_admin_menu(update, context)

def show_admin_menu(update: Update, context: CallbackContext):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    keyboard = [
        [InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data='admin_stats')],
        [InlineKeyboardButton("üì¢ –†–∞—Å—Å—ã–ª–∫–∞", callback_data='admin_broadcast')],
        [InlineKeyboardButton("üë• –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", callback_data='admin_search')],
        [InlineKeyboardButton("üè† –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    admin_text = f"""
üõ† <b>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>

üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(ADMINS)}
–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
    """
    
    if update.callback_query:
        update.callback_query.edit_message_text(admin_text, reply_markup=reply_markup, parse_mode='HTML')
    else:
        update.message.reply_text(admin_text, reply_markup=reply_markup, parse_mode='HTML')

def stats_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /stats"""
    user = update.effective_user
    
    if not is_admin(user.id):
        update.message.reply_text("‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    stats = get_statistics()
    
    stats_text = f"""
üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞</b>

üë• <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</b>
‚Ä¢ –í—Å–µ–≥–æ: {stats['total_users']}
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: {stats['active_users']}

üìà <b>–î–µ–π—Å—Ç–≤–∏—è:</b>
"""
    
    for action_type, count in stats['actions_count'].items():
        stats_text += f"‚Ä¢ {action_type}: {count}\n"
    
    stats_text += f"\nüïí <b>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:</b>\n"
    for action_type, timestamp in stats['recent_actions']:
        stats_text += f"‚Ä¢ {action_type} - {timestamp}\n"
    
    keyboard = [[InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É", callback_data='admin_back')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    update.message.reply_text(stats_text, reply_markup=reply_markup, parse_mode='HTML')

def broadcast_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /broadcast"""
    user = update.effective_user
    
    if not is_admin(user.id):
        update.message.reply_text("‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥–µ.")
        return
    
    if not context.args:
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω—é —Ä–∞—Å—Å—ã–ª–∫–∏
        keyboard = [
            [InlineKeyboardButton("üì¢ –í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º", callback_data='admin_broadcast_all')],
            [InlineKeyboardButton("üë• –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–±–µ–∑ –∞–¥–º–∏–Ω–æ–≤)", callback_data='admin_broadcast_users')],
            [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='admin_back')]
        ]
        reply_markup = InlineKeyboardMarkup(keyboard)
        
        update.message.reply_text(
            "üì¢ <b>–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π</b>\n\n"
            "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏:",
            reply_markup=reply_markup,
            parse_mode='HTML'
        )
        return
    
    # –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞–Ω —Å—Ä–∞–∑—É —Å –∫–æ–º–∞–Ω–¥–æ–π
    message_text = ' '.join(context.args)
    execute_broadcast(update, context, message_text, 'all')

def handle_admin_actions(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    query = update.callback_query
    query.answer()
    
    user = query.from_user
    
    if not is_admin(user.id):
        query.edit_message_text("‚õî –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞.")
        return
    
    action = query.data.replace('admin_', '')
    
    if action == 'stats':
        show_stats_menu(query)
    elif action == 'broadcast':
        show_broadcast_menu(query)
    elif action == 'search':
        show_search_menu(query)
    elif action == 'back':
        show_admin_menu_from_callback(query)
    elif action == 'broadcast_all':
        context.user_data['broadcast_type'] = 'all'
        context.user_data['awaiting_broadcast'] = True
        query.edit_message_text(
            "üì¢ <b>–†–∞—Å—Å—ã–ª–∫–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</b>\n\n"
            "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏:",
            parse_mode='HTML'
        )
    elif action == 'broadcast_users':
        context.user_data['broadcast_type'] = 'users'
        context.user_data['awaiting_broadcast'] = True
        query.edit_message_text(
            "üì¢ <b>–†–∞—Å—Å—ã–ª–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</b>\n\n"
            "–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏:",
            parse_mode='HTML'
        )

def handle_message(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user = update.effective_user
    message_text = update.message.text
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
    if is_admin(user.id) and context.user_data.get('awaiting_broadcast'):
        broadcast_type = context.user_data.get('broadcast_type', 'all')
        execute_broadcast(update, context, message_text, broadcast_type)
        context.user_data['awaiting_broadcast'] = False
        return
    
    # –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    log_user_action(user.id, 'message')
    update.message.reply_text(
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏. "
        "–ï—Å–ª–∏ –≤—ã –∑–∞–±–ª—É–¥–∏–ª–∏—Å—å, –≤–≤–µ–¥–∏—Ç–µ /start"
    )

def execute_broadcast(update: Update, context: CallbackContext, message_text, broadcast_type):
    """–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å—Å—ã–ª–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è"""
    user = update.effective_user
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
    if broadcast_type == 'all':
        users = broadcast_message(message_text, exclude_admins=False)
        target = "–≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º"
    else:
        users = broadcast_message(message_text, exclude_admins=True)
        target = "—Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–±–µ–∑ –∞–¥–º–∏–Ω–æ–≤)"
    
    total_users = len(users)
    successful = 0
    failed = 0
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ —Ä–∞—Å—Å—ã–ª–∫–∏
    status_message = update.message.reply_text(
        f"üì¢ <b>–ù–∞—á–∏–Ω–∞—é —Ä–∞—Å—Å—ã–ª–∫—É</b>\n\n"
        f"–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target}\n"
        f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}\n"
        f"–°—Ç–∞—Ç—É—Å: 0/{total_users}",
        parse_mode='HTML'
    )
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—Å—ã–ª–∫—É
    for i, user_id in enumerate(users):
        try:
            context.bot.send_message(
                chat_id=user_id,
                text=f"üì¢ <b>–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏:</b>\n\n{message_text}",
                parse_mode='HTML'
            )
            successful += 1
        except Exception as e:
            logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}: {e}")
            failed += 1
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 10 –æ—Ç–ø—Ä–∞–≤–æ–∫
        if i % 10 == 0 or i == total_users - 1:
            try:
                context.bot.edit_message_text(
                    chat_id=status_message.chat_id,
                    message_id=status_message.message_id,
                    text=f"üì¢ <b>–†–∞—Å—Å—ã–ª–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</b>\n\n"
                         f"–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target}\n"
                         f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}\n"
                         f"–°—Ç–∞—Ç—É—Å: {i+1}/{total_users}\n"
                         f"‚úÖ –£—Å–ø–µ—à–Ω–æ: {successful}\n"
                         f"‚ùå –û—à–∏–±–æ–∫: {failed}",
                    parse_mode='HTML'
                )
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: {e}")
    
    # –õ–æ–≥–∏—Ä—É–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    log_admin_action(
        user.id,
        'broadcast',
        details=f"–¢–∏–ø: {broadcast_type}, –ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π: {total_users}, –£—Å–ø–µ—à–Ω–æ: {successful}, –û—à–∏–±–æ–∫: {failed}"
    )
    
    # –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    try:
        context.bot.edit_message_text(
            chat_id=status_message.chat_id,
            message_id=status_message.message_id,
            text=f"‚úÖ <b>–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</b>\n\n"
                 f"–¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: {target}\n"
                 f"–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {total_users}\n"
                 f"‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {successful}\n"
                 f"‚ùå –û—à–∏–±–æ–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏: {failed}",
            parse_mode='HTML'
        )
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: {e}")

def show_stats_menu(query):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
    stats = get_statistics()
    
    stats_text = f"""
üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞</b>

üë• <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</b>
‚Ä¢ –í—Å–µ–≥–æ: {stats['total_users']}
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: {stats['active_users']}

üìà <b>–î–µ–π—Å—Ç–≤–∏—è:</b>
"""
    
    for action_type, count in stats['actions_count'].items():
        stats_text += f"‚Ä¢ {action_type}: {count}\n"
    
    keyboard = [[InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥ –≤ –∞–¥–º–∏–Ω–∫—É", callback_data='admin_back')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(stats_text, reply_markup=reply_markup, parse_mode='HTML')

def show_broadcast_menu(query):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é —Ä–∞—Å—Å—ã–ª–∫–∏"""
    keyboard = [
        [InlineKeyboardButton("üì¢ –í—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º", callback_data='admin_broadcast_all')],
        [InlineKeyboardButton("üë• –¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (–±–µ–∑ –∞–¥–º–∏–Ω–æ–≤)", callback_data='admin_broadcast_users')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='admin_back')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(
        "üì¢ <b>–†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ä–∞—Å—Å—ã–ª–∫–∏:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

def show_search_menu(query):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    query.edit_message_text(
        "üë• <b>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</b>\n\n"
        "–î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:\n"
        "<code>/user USER_ID</code>\n\n"
        "–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–µ—Ä–µ—à–ª–∏—Ç–µ –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É @userinfobot",
        parse_mode='HTML'
    )

def show_admin_menu_from_callback(query):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–∑ callback"""
    keyboard = [
        [InlineKeyboardButton("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data='admin_stats')],
        [InlineKeyboardButton("üì¢ –†–∞—Å—Å—ã–ª–∫–∞", callback_data='admin_broadcast')],
        [InlineKeyboardButton("üë• –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è", callback_data='admin_search')],
        [InlineKeyboardButton("üè† –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    admin_text = f"""
üõ† <b>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</b>

üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤: {len(ADMINS)}
–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
    """
    
    query.edit_message_text(admin_text, reply_markup=reply_markup, parse_mode='HTML')

# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
def help_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    user = update.effective_user
    
    help_text = """
ü§ñ <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>

/start - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞
/payment - –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã
/documents - –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
/faq - –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
    """
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    if is_admin(user.id):
        help_text += """
        
üõ† <b>–ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</b>

/admin - –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
/stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
/broadcast - –†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
        """
    
    help_text += "\n–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é!"
    
    update.message.reply_text(help_text, parse_mode='HTML')

def payment_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /payment"""
    send_payment_info(update, context)

def documents_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /documents"""
    send_documents_info(update, context)

def faq_command(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /faq"""
    send_faq_info(update, context)

def send_payment_info(update: Update, context: CallbackContext):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–µ (–∫–æ–º–∞–Ω–¥–∞)"""
    message = format_payment_info()
    keyboard = [[InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    update.message.reply_text(message, reply_markup=reply_markup, parse_mode='HTML')

def send_payment_info_callback(query):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–ø–ª–∞—Ç–µ (callback)"""
    message = format_payment_info()
    keyboard = [[InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(message, reply_markup=reply_markup, parse_mode='HTML')

def send_documents_info(update: Update, context: CallbackContext):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∫–æ–º–∞–Ω–¥–∞)"""
    keyboard = [[InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    update.message.reply_text(DOCUMENTS_LIST, reply_markup=reply_markup, parse_mode='HTML')

def send_documents_info_callback(query):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (callback)"""
    keyboard = [[InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(DOCUMENTS_LIST, reply_markup=reply_markup, parse_mode='HTML')

def send_faq_info(update: Update, context: CallbackContext):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å FAQ (–∫–æ–º–∞–Ω–¥–∞)"""
    keyboard = [[InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    update.message.reply_text(FAQ_TEXT, reply_markup=reply_markup, parse_mode='HTML')

def send_faq_info_callback(query):
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å FAQ (callback)"""
    keyboard = [[InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(FAQ_TEXT, reply_markup=reply_markup, parse_mode='HTML')

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é
def handle_main_menu(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é"""
    query = update.callback_query
    query.answer()
    
    action = query.data.replace('main_', '')
    
    if action == 'districts':
        show_districts_menu(query)
    elif action == 'payment':
        send_payment_info_callback(query)
    elif action == 'documents':
        send_documents_info_callback(query)
    elif action == 'faq':
        send_faq_info_callback(query)

def show_districts_menu(query):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–∞"""
    keyboard = [
        [InlineKeyboardButton("–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω", callback_data='district_central')],
        [InlineKeyboardButton("–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω", callback_data='district_avtozavodsky')],
        [InlineKeyboardButton("–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω", callback_data='district_komso')],
        [InlineKeyboardButton("–ñ–∏–≥—É–ª—ë–≤—Å–∫", callback_data='district_zhig')],
        [InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data='back_to_main')]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(
        "üèÉ <b>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–π–æ–Ω:</b>\n\n"
        "–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:\n"
        "‚Ä¢ –ê–¥—Ä–µ—Å –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ\n"
        "‚Ä¢ –°—Å—ã–ª–∫—É –Ω–∞ —á–∞—Ç —Ä–æ–¥–∏—Ç–µ–ª–µ–π\n"
        "‚Ä¢ –í—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

def handle_district_selection(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ä–∞–π–æ–Ω–∞"""
    query = update.callback_query
    query.answer()
    
    district_key = query.data.replace('district_', '')
    district_info = DISTRICTS_INFO.get(district_key)
    
    if not district_info:
        query.edit_message_text("–†–∞–π–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return
    
    # –î–ª—è –ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –±–∞–∑—ã
    if district_key == 'avtozavodsky':
        show_bases_menu(query, district_info)
        return
    
    # –î–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–π–æ–Ω–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å—Ä–∞–∑—É
    message = format_district_info(district_info)
    keyboard = [
        [InlineKeyboardButton("üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ–ø–ª–∞—Ç—ã", callback_data='main_payment')],
        [InlineKeyboardButton("üìã –î–æ–∫—É–º–µ–Ω—Ç—ã", callback_data='main_documents')],
        [InlineKeyboardButton("‚óÄÔ∏è –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–æ–π —Ä–∞–π–æ–Ω", callback_data='main_districts')],
        [InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    query.edit_message_text(message, reply_markup=reply_markup, parse_mode='HTML')

def show_bases_menu(query, district_info):
    """–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ –±–∞–∑—ã –¥–ª—è –ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–æ–≥–æ —Ä–∞–π–æ–Ω–∞"""
    keyboard = []
    
    for base_key, base_info in district_info['bases'].items():
        keyboard.append([InlineKeyboardButton(base_info['name'], callback_data=f'base_{base_key}')])
    
    keyboard.append([InlineKeyboardButton("‚óÄÔ∏è –ù–∞–∑–∞–¥ –∫ —Ä–∞–π–æ–Ω–∞–º", callback_data='main_districts')])
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    query.edit_message_text(
        "üè¢ <b>–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω</b>\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —É–¥–æ–±–Ω—É—é –≤–∞–º –±–∞–∑—É:",
        reply_markup=reply_markup,
        parse_mode='HTML'
    )

def handle_base_selection(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –±–∞–∑—ã"""
    query = update.callback_query
    query.answer()
    
    base_key = query.data.replace('base_', '')
    district_info = DISTRICTS_INFO['avtozavodsky']
    base_info = district_info['bases'].get(base_key)
    
    if not base_info:
        query.edit_message_text("–ë–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        return
    
    message = format_base_info(district_info, base_info)
    keyboard = [
        [InlineKeyboardButton("üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ–ø–ª–∞—Ç—ã", callback_data='main_payment')],
        [InlineKeyboardButton("üìã –î–æ–∫—É–º–µ–Ω—Ç—ã", callback_data='main_documents')],
        [InlineKeyboardButton("‚óÄÔ∏è –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –±–∞–∑—É", callback_data='district_avtozavodsky')],
        [InlineKeyboardButton("üè† –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data='back_to_main')]
    ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    query.edit_message_text(message, reply_markup=reply_markup, parse_mode='HTML')

def handle_back(update: Update, context: CallbackContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥"""
    query = update.callback_query
    query.answer()
    
    action = query.data.replace('back_', '')
    
    if action == 'to_main':
        start_command_callback(query)

def start_command_callback(query):
    """–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –¥–ª—è callback"""
    user = query.from_user
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
    if is_admin(user.id):
        keyboard = [
            [InlineKeyboardButton("üèÉ –í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω", callback_data='main_districts')],
            [InlineKeyboardButton("üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ–ø–ª–∞—Ç—ã", callback_data='main_payment')],
            [InlineKeyboardButton("üìã –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", callback_data='main_documents')],
            [InlineKeyboardButton("‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã", callback_data='main_faq')],
            [InlineKeyboardButton("üõ† –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data='admin_back')]
        ]
    else:
        keyboard = [
            [InlineKeyboardButton("üèÉ –í—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω", callback_data='main_districts')],
            [InlineKeyboardButton("üí≥ –†–µ–∫–≤–∏–∑–∏—Ç—ã –æ–ø–ª–∞—Ç—ã", callback_data='main_payment')],
            [InlineKeyboardButton("üìã –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", callback_data='main_documents')],
            [InlineKeyboardButton("‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã", callback_data='main_faq')]
        ]
    
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    welcome_text = f"""
ü§∫ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>–¢–æ–ª—å—è—Ç—Ç–∏–Ω—Å–∫—É—é —Ñ–µ–¥–µ—Ä–∞—Ü–∏–∏ —Ñ–µ—Ö—Ç–æ–≤–∞–Ω–∏—è</b>!

–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª:
    """
    
    query.edit_message_text(welcome_text, reply_markup=reply_markup, parse_mode='HTML')

# –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
def format_district_info(district_info):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–π–æ–Ω–µ"""
    return f"""
<b>{district_info['name']}</b>

üìç <b>–ê–¥—Ä–µ—Å:</b> {district_info['address']}

üìÖ <b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:</b>
{district_info['schedule']}

üí¨ <b>–ß–∞—Ç –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π:</b> {district_info['chat_link']}

üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {district_info['price']}

üëï <b>–° —Å–æ–±–æ–π –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É:</b> —Å–º–µ–Ω–Ω—ã–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –¥–ª—è –∑–∞–ª–∞, –±–µ–ª—ã–µ –Ω–æ—Å–∫–∏, —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è —Ñ–æ—Ä–º–∞, –±—É—Ç—ã–ª–æ—á–∫–∞ —Å –≤–æ–¥–æ–π

‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b> –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω–æ –ø–ª–∞—Ç–∏—Ç—å –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã! –í—Å–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!
    """

def format_base_info(district_info, base_info):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∞–∑–µ"""
    return f"""
<b>{district_info['name']} - {base_info['name']}</b>

üìç <b>–ê–¥—Ä–µ—Å:</b> {base_info['address']}

üìÖ <b>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:</b>
{base_info['schedule']}

üí¨ <b>–ß–∞—Ç –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π:</b> {district_info['chat_link']}

üí∞ <b>–°—Ç–æ–∏–º–æ—Å—Ç—å:</b> {district_info['price']}

üëï <b>–° —Å–æ–±–æ–π –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É:</b> —Å–º–µ–Ω–Ω—ã–µ –∫—Ä–æ—Å—Å–æ–≤–∫–∏ –¥–ª—è –∑–∞–ª–∞, –±–µ–ª—ã–µ –Ω–æ—Å–∫–∏, —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è —Ñ–æ—Ä–º–∞, –±—É—Ç—ã–ª–æ—á–∫–∞ —Å –≤–æ–¥–æ–π

‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b> –ø–æ–∫–∞ –Ω–µ –Ω—É–∂–Ω–æ –ø–ª–∞—Ç–∏—Ç—å –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã! –í—Å–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ!
    """

def format_payment_info():
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–ø–ª–∞—Ç–µ"""
    return f"""
üí≥ <b>–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</b>

üèõ <b>–ü–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:</b> 
{ORG_INFO['full_name']}

üìã <b>–°–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–µ:</b> 
{ORG_INFO['short_name']}

üìä <b>–†–µ–∫–≤–∏–∑–∏—Ç—ã:</b>
–ò–ù–ù: {ORG_INFO['inn']}
–ö–ü–ü: {ORG_INFO['kpp']}
–û–ì–†–ù: {ORG_INFO['ogrn']}
–†–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç: {ORG_INFO['account']}
–ë–∞–Ω–∫: {ORG_INFO['bank']}
–ë–ò–ö: {ORG_INFO['bik']}
–ö–æ—Ä—Ä. —Å—á–µ—Ç: {ORG_INFO['correspondent_account']}

üí∏ <b>–°—É–º–º–∞:</b> 2000 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü
üìù <b>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:</b> "–î–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–µ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ –æ—Ç [–§–ò–û —Ä–µ–±–µ–Ω–∫–∞]"

‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b>
‚Ä¢ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–±–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
‚Ä¢ –í –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ —É–∫–∞–∂–∏—Ç–µ –§–ò–û —Ä–µ–±–µ–Ω–∫–∞
‚Ä¢ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —á–µ–∫ –æ–± –æ–ø–ª–∞—Ç–µ
‚Ä¢ –ö–≤–∏—Ç–∞–Ω—Ü–∏—é –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–Ω–µ—Ä—É –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç –≥—Ä—É–ø–ø—ã
    """
